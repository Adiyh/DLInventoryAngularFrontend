<div class="gantt-editor">
  <form [formGroup]="ganttForm" class="top-bar" (ngSubmit)="showGanttChart()">
    <label for="projectName">
      Project Name:
      <input id="projectName" name="projectName" formControlName="projectName" required />
    </label>

    <label for="targetVersion">
      Target Version:
      <input id="targetVersion" name="targetVersion" formControlName="targetVersion" required />
    </label>

    <button type="submit" [disabled]="ganttForm.invalid || ganttChartLoading">Load</button>

    <div class="view-toggle">
      <button type="button" (click)="toggleView()">
        {{ showGrid ? 'Show Chart' : 'Show Grid' }}
      </button>
    </div>
  </form>

  <div class="gantt-editor-container">
    <!-- Grid Section -->
    <div *ngIf="showGrid" class="gantt-grid-section">
      <h4>Task List</h4>

      <label for="resourceFilter">
        Filter by Resource:
        <select
          id="resourceFilter"
          name="resourceFilter"
          [(ngModel)]="selectedResourceId"
          (change)="applyResourceFilter()">
          <option [ngValue]="null">All</option>
          <option *ngFor="let resource of ganttResources" [ngValue]="resource.id">
            {{ resource.text }}
          </option>
        </select>
      </label>

      <table class="gantt-grid-table">
        <thead>
          <tr>
            <th>Summary</th>
            <th>Resource</th>
            <th>Start Date</th>
            <th>Current Merge Date</th>
            <th>Progress</th>
            <th>Actions</th>
            <th>Loader</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let task of filteredTasks" (dblclick)="onRowDblClick(task)">
            <td>{{ task.title }}</td>
            <td>{{ getResourceName(task.id) }}</td>
            <td>{{ task.start }}</td>
            <td>
              <input
                type="date"
                [(ngModel)]="task.end"
                [name]="'end-' + task.id"
                [id]="'end-' + task.id" />
            </td>
            <td>
              <input
                type="number"
                [(ngModel)]="task.progress"
                [name]="'progress-' + task.id"
                [id]="'progress-' + task.id" />%
            </td>
            <td>
              <button type="button" (click)="saveTask(task)">Save</button>
            </td>
            <td>
              <button type="button" (click)="showGanttChart()" style="background-color: darkblue; color: white;">Refresh Chart</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Chart Section -->
    <div *ngIf="!showGrid" class="gantt-chart-section">
      <dx-gantt
        *ngIf="ganttChartReady"
        [tasks]="{ dataSource: filteredTasks }"
        [dependencies]="{ dataSource: ganttDependencies }"
        [resources]="{ dataSource: ganttResources }"
        [resourceAssignments]="{ dataSource: ganttAssignments }"
        [height]="500">
      </dx-gantt>
      <div *ngIf="ganttChartLoading" class="gantt-loading">Loading chart...</div>
    </div>
  </div>
</div>
