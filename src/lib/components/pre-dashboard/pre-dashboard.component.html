<div class="pre-dashboard-container">
  <div class="header">
    <div></div>
    <div class="header-actions">
      <button class="btn btn-primary ms-2" (click)="openAddTypeModal()">Add Asset Type</button>
      <button class="btn btn-success" (click)="openAddAssetModal()" [disabled]="!selectedAssetType">
        Add Asset
      </button>
      <button class="btn btn-outline-primary ms-2" (click)="exportReport()" [disabled]="!selectedAssetType">
        Export Report
      </button>
      <button class="btn btn-primary ms-2" (click)="exportOverallReport()" style="border-color: black;">
        Export Overall Report
      </button>
      <button class="btn btn-primary ms-2" (click)="goToVendorDashboard()">
        Go to Vendor Dashboard
      </button>
      <button class="btn btn-primary" (click)="goToAssetDashboard()">
        Go to Asset Dashboard
      </button>
      <button class="btn btn-primary" (click)="goToEmployeeDashboard()">
        Go to Employee Dashboard
      </button>
     <form class="search-inline-form ms-2 search-right" (submit)="searchEmployeeAssets(searchEmployeeId); $event.preventDefault();">
    <div class="search-inline-group">
      <input [(ngModel)]="searchEmployeeId" name="searchEmployeeId" class="form-control search-inline-input" placeholder="Emp ID" />
      <button class="btn btn-outline-secondary search-inline-btn" type="submit" title="Search">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="7"/>
          <line x1="16.5" y1="16.5" x2="21" y2="21"/>
        </svg>
      </button>
    </div>
  </form>
</div>
  </div>

  <!-- Modal for search results -->
  <div class="modal-backdrop" *ngIf="showSearchModal"></div>
  <div class="modal" *ngIf="showSearchModal">
    <div class="modal-content">
      <button class="btn-close float-end" (click)="closeSearchModal()" aria-label="Close">Close</button>
      <h5>Assets for Employee ID: {{ searchEmployeeId }}</h5>
      <ul *ngIf="filteredAssets?.length; else noAssets">
        <li *ngFor="let asset of filteredAssets">
          {{ asset.type || asset.Type }} - {{ asset | json }}
        </li>
      </ul>
      <ng-template #noAssets>
        <div>No assets found for this employee.</div>
      </ng-template>
    </div>
  </div>

  <div class="asset-type-selector">
  <label for="assetType" class="asset-type-label">Select Asset Type to Add New Asset:</label>
  <div class="custom-select-wrapper">
    <select id="assetType" [(ngModel)]="selectedAssetType" class="form-select custom-select">
      <option value="" disabled>Select type</option>
      <option *ngFor="let type of assetTypes" [value]="type">{{ type }}</option>
    </select>
    <span class="custom-select-arrow">&#9662;</span>
  </div>
</div>
  <div class="asset-summary-cards">
    <div
      class="summary-card"
      *ngFor="let summary of assetSummaries"
      (dblclick)="goToAssetDashboardWithType(summary.type)"
      style="cursor: pointer;"
      title="Double-click to view details"
    >
      <h4>{{ summary.type }}</h4>
      <p>{{ summary.count }} assets</p>
    </div>
  </div>

  <!-- Modal for adding new asset type -->
  <div class="modal-backdrop" *ngIf="showAddTypeModal"></div>
  <div class="modal" *ngIf="showAddTypeModal">
    <div class="modal-content">
      <h5>Add New Asset Type</h5>
      <input [(ngModel)]="newAssetType" class="form-control" placeholder="Asset Type Name" />
      <div class="mt-3">
        <button class="btn btn-primary" (click)="addAssetType()">Add</button>
        <button class="btn btn-secondary ms-2" (click)="showAddTypeModal=false">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Modal for adding asset with dynamic fields -->
  <div class="modal-backdrop" *ngIf="showAddAssetModal"></div>
  <div class="modal" *ngIf="showAddAssetModal">
    <div class="modal-content">
      <h5>Add {{ selectedAssetType }} Asset</h5>
      <!-- Asset ID field (always present) -->
      <div class="d-flex align-items-center mb-2">
        <input class="form-control me-2" value="AssetId" readonly />
        <input [(ngModel)]="assetIdField" class="form-control me-2" placeholder="Asset ID" required />
      </div>
      <div *ngIf="!assetIdField" class="text-danger mb-2">
        AssetId is required.
      </div>
      <!-- Employee ID field (always present) -->
      <div class="d-flex align-items-center mb-2">
        <input class="form-control me-2" value="EmployeeId" readonly />
        <input [(ngModel)]="employeeIdField" class="form-control me-2" placeholder="Employee ID" />
      </div>
      <div *ngFor="let field of dynamicFields; let i = index" class="d-flex align-items-center mb-2">
        <input [(ngModel)]="field.key" class="form-control me-2" placeholder="Field Name" readonly />
        <input [(ngModel)]="field.value" class="form-control me-2" placeholder="Value" />
        <button class="btn btn-danger btn-sm" (click)="removeField(i)">Remove</button>
      </div>
      <div class="d-flex align-items-center mb-3">
        <input [(ngModel)]="newFieldName" class="form-control me-2" placeholder="New Field Name" />
        <button class="btn btn-outline-primary btn-sm" (click)="addField()">Add Field</button>
      </div>
      <div>
        <button class="btn btn-success" (click)="saveAsset()" [disabled]="!assetIdField">Save Asset</button>
        <button class="btn btn-secondary ms-2" (click)="showAddAssetModal=false">Cancel</button>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <strong>Total Assets in Inventory:</strong> {{ totalAssetCount }}
  </div>
</div>